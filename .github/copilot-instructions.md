# 概要
- このアプリケーションは、テーブルデータを管理する為のGUIツールである。
- GUIライブラリとして、fyne(v2)を使用する。
- C言語ソースコードを扱うが、これらは全て参照するだけである。

# パッケージ構成
## main
- main.goに実装する。
- 基本的に他パッケージで定義した構造体やメソッドを呼び出すだけ。

## mygui
- fyneを用いたGUI部分の実装を担う。
- メインウィンドウにメイン機能を実装し、そのメインウィンドウの特定のボタンを押下すると、別機能を使用する為のウィンドウが新たに開かれるという仕組みを採用する。
  - メインウィンドウはアプリ実行中は常駐する。
  - 複数ウィンドウが開かれているときでもそれぞれのウィンドウを操作できるようにする。
- テーブルデータは、後述のmydataパッケージから取得する。
  - myastパッケージは、myguiパッケージからはアクセスしない。

### Mw構造体（メインウィンドウ）
- メインウィンドウに関する実装を行う。
- 表示するUIパーツは`MwUiItem`構造体でまとめて宣言する。
- 左側にテーブル一覧のリストを表示する。（テーブル数が多くなることが想定されるので、スクロール可能にしておく。）
- 右側には、選択したテーブルのテーブル値を表示する領域を設置する。
  - 表形式で表示する。
  - 「最初の5個」のように一部を表示するのではなく、全てのデータを表示するようにする。
  - データ数が多いので、縦にスクロースして表示できるようにする。（横方向のスクロールは禁止。）
- 左右の横幅の比率は、初期値は3:7にするが、自由に変更できるようにしておく。
- テーブルデータで、`WELDTABLE_GX3`構造体のメンバ変数が構造体や配列になっている場合、表形式で表示するようにする。
  - 配列をそのまま表示するのは見づらいので禁止。
  - ただし表示コストを下げるため描画は遅延・必要時のみ行う。
- テーブルデータの場所について、`weldtbl.c`をresフォルダに配置されているものではなく、外部の任意の場所にあるファイルを参照するようにする。ファイル指定のダイアログを出す為のボタンを作成する。

### TwoCompare構造体（2テーブル比較ウィンドウ）
- 2テーブルを選択し、それらのテーブル値を比較する。
- 異なる値である箇所をハイライトする機能を持たせる。
- 左右に2つのテーブルを並べて表示するUIとする。
- テーブルデータの表示方法は、メインウィンドウと同様にする。
  - 表形式で表示する。
  - 「最初の5個」のように一部を表示するのではなく、全てのデータを表示するようにする。
  - データ数が多いので、縦にスクロースして表示できるようにする。（横方向のスクロールは禁止。）
  - テーブルデータで、`WELDTABLE_GX3`構造体のメンバ変数が構造体や配列になっている場合、表形式で表示するようにする。
    - 配列をそのまま表示するのは見づらいので禁止。
    - ただし表示コストを下げるため描画は遅延・必要時のみ行う。

### DataCompare構造体（特定のデータを全テーブルで比較するウィンドウ）
- テーブルの特定のデータを指定し、そのデータが全テーブルでどんな値がセットされているかを比較する。
- 最も多いデータにハイライトするようにする。
  - 5つのテーブルが存在し、指定データがそれぞれ、[1,5,1,4,1]である場合、`1`にハイライトするということ。
  - 複数種類のデータが最多である場合は色を変えてハイライトする。
  - 各値が何個ずつだったかという情報はGUIに表示しない。
- 指定バラメータの部分のみを抽出したものをテーブルごとに表示する。
  - "Table0の値"、"Table1の値"、...といった具合に表形式で表示する。

## myast
- 参照するC言語ソースを正確に認識する為に、ASTツリーを構築する。
- 構築したASTツリーを元にテーブルデータを取得し、後述のmydataパッケージに渡す。
- このパッケージは、後述のmydataパッケージからのみ参照される。
- ASTツリーの構築はとにかく正確にデータ構造を読み取れるようにすることに重きを置く。
  - 正規表現は正確さにかけるので、なるべく使用は控える。
    - 確実に動作する確証がある場合は使用して問題ない。

## mydata
- 前述のmtastパッケージで取得したテーブルデータを管理するパッケージ。
- `weldtable_org.h`で定義した構造体を模した構造体群をdata.goに定義する。
- `var TableList []TableData`のスライスに読み込んだテーブルデータが全て格納されるようにする。
- 前述のmyguiパッケージでは、この`TableList`を参照することでテーブルデータを取得する。


# テーブルについて
## 概要
- テーブルに関する参照すべきC言語ソースコードは、resフォルダに配置している。
- テーブル1つ分のデータは、`WELDTABLE_GX3`構造体1つ分のデータに相当する。
- `WELDTABLE_GX3`構造体の定義は、`weldtable_org.h`で行われている。
  - この構造体のメンバ変数には、別の構造体も含まれている。これらすべては`weldtable_org.h`で定義されているので、参照すること。
- 実際のテーブルデータは、`weldtbl.c`で、`WELDTABLE_GX3`型のconst配列変数`WeldTable`としてセットされている。
- プリプロセッサ(#define)が途中に出てくるが、これらは無視すること。
  - テーブルの値を参照するという目的においては干渉しないので無視で差し支えない。

## 型について
- 構造体の定義内では、一般的でない型を使用していることがある。これらの定義は`typedef.h`で行っている。

## 文字コードについて
- 参照するC言語のソースコードはいずれも`shiftjis`である。

## データの種類
- `WELDTABLE_GX3`構造体のメンバ変数について、以下の対応関係がある。
  - 変数名をそのままUIに表示するとよくわからないので、この説明の方を表示するようにする。

| メンバ変数 | 説明 |
|---|---|
| WeldCode | 溶接種別コード |
| A2S_Pulse | ワイヤ送給テーブル（パルス） |
| S2V_Pulse | 一元電圧テーブル（パルス） |
| A2S_Short | ワイヤ送給テーブル（短絡） |
| S2V_Short | 一元電圧テーブル（短絡） |
| WeldParm | 半固定パラメータ |
| CalParm[116] | 可変パラメータ係数 |
| ParmTbl_Pls | パラメータテーブル（パルス） |
| ParmTbl_Short | パラメータテーブル（短絡） |
| CalParmList | 可変パラメータのテーブル引きリスト |
| V05_Data[128] | V5 テーブル |
| V06_Data[128] | V6 テーブル |
| V08_Data[128] | V8 テーブル |
| V12_Data[128] | V12 テーブル |
| V32_Data[128] | V32 テーブル |
| V34_Data[128] | V34 テーブル |
| V36_Data[128] | V36 テーブル |
| V56_Data[128] | V56 テーブル |
| V59_Data[128] | V59 テーブル |
| V68_Data[128] | V68 テーブル |
| V13_Data[128] | V13 テーブル |
| V15_Data[128] | V15 テーブル |
| V18_Data[128] | V18 テーブル |
| V19_Data[128] | V19 テーブル |
| V20_Data[128] | V20 テーブル |
| V94_Data[128] | V94 テーブル |
| V95_Data[128] | V95 テーブル |
| V57_Data[128] | V57 テーブル |
| V93_Data[128] | V93 テーブル |
| CalParmDataTable[PRESET_CALPARM_LIST_MAX-1] | 可変パラメータのテーブル引きデータ |
| Navi_Pram1[7] | 短絡用溶接ナビデータ：T継ぎ手データ |
| Navi_Pram2[7] | 短絡用溶接ナビデータ：重ね継ぎ手データ |
| Navi_Pram3[7] | 短絡用溶接ナビデータ：突き合わせデータ |
| Navi_P_Pram1[7] | パルス用溶接ナビデータ：T継ぎ手データ |
| Navi_P_Pram2[7] | パルス用溶接ナビデータ：重ね継ぎ手データ |
| Navi_P_Pram3[7] | パルス用溶接ナビデータ：突き合わせデータ |

### GUIでのデータ表示方法
- 配列や構造体メンバは「表形式（縦スクロール、横スクロール禁止）」で表示すること。
  - 半固定パラメータ（WeldParm）は、`WELDPARM`型であり、その中身は、配列データである。これは0番目の要素から順に、`H1`,`H2`,`H3`,...といった具合に対応している。よって、"H1の値"、"H2の値"、...といった具合に表形式で表示する。
  - 可変パラメータ係数（CalParm）は、配列の各要素が`DCCALPARM`型である。これは0番目の要素から順に、`V1`,`V2`,`V3`,...といった具合に対応している。また、`DCCALPARM`型はa,b,c,min,maxの5つのfloat型のデータを持つ。よって、"V1のa,b,c,min,max"、"V2のa,b,c,min,max"、...といった具合になるように表形式で表示する。

# 細かい注意事項
- ソースコードを説明するコメント分は日本語で記述する。